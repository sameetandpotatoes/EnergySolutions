- content_for :head do
  %title Pure Energy | Results
  %meta{content: "Pure Energy results page that shows homeowners to view federal and state grants in their current state. It also displays viable renewable energy resources in their current location.", name: "description"}/
:javascript
  window.google = window.google || {};
  google.maps = google.maps || {};
  (function() {

    function getScript(src) {
      document.write('<' + 'script src="' + src + '"' +
                     ' type="text/javascript"><' + '/script>');
    }

    var modules = google.maps.modules = {};
    google.maps.__gjsload__ = function(name, text) {
      modules[name] = text;
    };

    google.maps.Load = function(apiLoad) {
      delete google.maps.Load;
      apiLoad([0.009999999776482582,[[["https://mts0.googleapis.com/vt?lyrs=m@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.googleapis.com/vt?lyrs=m@248000000\u0026src=api\u0026hl=en-US\u0026"],null,null,null,null,"m@248000000",["https://mts0.google.com/vt?lyrs=m@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.google.com/vt?lyrs=m@248000000\u0026src=api\u0026hl=en-US\u0026"]],[["https://khms0.googleapis.com/kh?v=143\u0026hl=en-US\u0026","https://khms1.googleapis.com/kh?v=143\u0026hl=en-US\u0026"],null,null,null,1,"143",["https://khms0.google.com/kh?v=143\u0026hl=en-US\u0026","https://khms1.google.com/kh?v=143\u0026hl=en-US\u0026"]],[["https://mts0.googleapis.com/vt?lyrs=h@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.googleapis.com/vt?lyrs=h@248000000\u0026src=api\u0026hl=en-US\u0026"],null,null,null,null,"h@248000000",["https://mts0.google.com/vt?lyrs=h@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.google.com/vt?lyrs=h@248000000\u0026src=api\u0026hl=en-US\u0026"]],[["https://mts0.googleapis.com/vt?lyrs=t@132,r@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.googleapis.com/vt?lyrs=t@132,r@248000000\u0026src=api\u0026hl=en-US\u0026"],null,null,null,null,"t@132,r@248000000",["https://mts0.google.com/vt?lyrs=t@132,r@248000000\u0026src=api\u0026hl=en-US\u0026","https://mts1.google.com/vt?lyrs=t@132,r@248000000\u0026src=api\u0026hl=en-US\u0026"]],null,null,[["https://cbks0.googleapis.com/cbk?","https://cbks1.googleapis.com/cbk?"]],[["https://khms0.googleapis.com/kh?v=83\u0026hl=en-US\u0026","https://khms1.googleapis.com/kh?v=83\u0026hl=en-US\u0026"],null,null,null,null,"83",["https://khms0.google.com/kh?v=83\u0026hl=en-US\u0026","https://khms1.google.com/kh?v=83\u0026hl=en-US\u0026"]],[["https://mts0.googleapis.com/mapslt?hl=en-US\u0026","https://mts1.googleapis.com/mapslt?hl=en-US\u0026"]],[["https://mts0.googleapis.com/mapslt/ft?hl=en-US\u0026","https://mts1.googleapis.com/mapslt/ft?hl=en-US\u0026"]],[["https://mts0.googleapis.com/vt?hl=en-US\u0026","https://mts1.googleapis.com/vt?hl=en-US\u0026"]],[["https://mts0.googleapis.com/mapslt/loom?hl=en-US\u0026","https://mts1.googleapis.com/mapslt/loom?hl=en-US\u0026"]],[["https://mts0.googleapis.com/mapslt?hl=en-US\u0026","https://mts1.googleapis.com/mapslt?hl=en-US\u0026"]],[["https://mts0.googleapis.com/mapslt/ft?hl=en-US\u0026","https://mts1.googleapis.com/mapslt/ft?hl=en-US\u0026"]]],["en-US","US",null,0,null,null,"https://maps.gstatic.com/mapfiles/","https://csi.gstatic.com","https://maps.googleapis.com","https://maps.googleapis.com"],["https://maps.gstatic.com/intl/en_us/mapfiles/api-3/15/5","3.15.5"],[1694614384],1,null,null,null,null,1,"",null,null,1,"https://khms.googleapis.com/mz?v=143\u0026","AIzaSyCSLTNWsGK06_1V4Nf-O1AlOR5X0iSuxY8","https://earthbuilder.googleapis.com","https://earthbuilder.googleapis.com",null,"https://mts.googleapis.com/vt/icon",[["https://mts0.googleapis.com/vt","https://mts1.googleapis.com/vt"],["https://mts0.googleapis.com/vt","https://mts1.googleapis.com/vt"],[null,[[0,"m",248000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[47],[37,[["smartmaps"]]]]],0],[null,[[0,"m",248000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[47],[37,[["smartmaps"]]]]],3],[null,[[0,"m",248000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[50],[37,[["smartmaps"]]]]],0],[null,[[0,"m",248000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[50],[37,[["smartmaps"]]]]],3],[null,[[4,"t",132],[0,"r",132000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[5],[37,[["smartmaps"]]]]],0],[null,[[4,"t",132],[0,"r",132000000]],[null,"en-US","US",null,18,null,null,null,null,null,null,[[5],[37,[["smartmaps"]]]]],3],[null,null,[null,"en-US","US",null,18],0],[null,null,[null,"en-US","US",null,18],3],[null,null,[null,"en-US","US",null,18],6],[null,null,[null,"en-US","US",null,18],0],["https://mts0.google.com/vt","https://mts1.google.com/vt"],"/maps/vt"],2,500], loadScriptTime);
    };
    var loadScriptTime = (new Date).getTime();
    getScript("https://maps.gstatic.com/intl/en_us/mapfiles/api-3/15/5/main.js");
  })();
%p.state{style: "display: none;"}= @state
%p#lat{style: "display: none;"}= @lat
%p#long{style: "display: none;"}= @long
%p#energy{style: "display: none;", 'data-id' => "#{@energy}"}
:javascript
  $(document).ready(function(){
    var energies = document.getElementsByClassName("energy-type");
    var energytext = document.getElementsByClassName("energy");
    var wrapper = document.getElementsByClassName("col");
    for (var index = 0; index < energies.length; index++){
      var text = energies[index].innerHTML;
      if (text != null){
        $(energies[index]).attr("href","/" + text.toLowerCase());
        $(wrapper[index]).addClass(text.toLowerCase());
      }
    }
  });
%h1.header-results
  Renewable Energy Sources Available in
  %span #{@city.titlecase}, #{@state}
.loc-div
  .results
    - if !@energy.has_value?(true)
      .results-energy
        .f-col-wrapper#results-wrapper
          .col.f-col1.solar{:style => "width: 500px"}
            .icon-wrap#results-icon-wrap
              %p.results-inline There are no suitable renewable energy resources in your area. However, feel free to look at the incentives in your area to switch to a renewable energy resource while saving money.
    - else
      - @energy.each do |k,v|
        .results-energy
          - if (v)
            .f-col-wrapper#results-wrapper
              .col.f-col1
                .icon-wrap#results-icon-wrap
                  %a.results-inline.energy-type#first #{k}
                  %a.results-inline.energy Energy
  = render "map"
  #map-canvas
%h1.header-results
  Grants Near #{@city.titlecase}, #{@state}
%p.source-text Information provided by dsireusa.org and afdc.energy.gov
#tab-container.tab-container
  %ul.etabs
    %li.tab
      %a{href: "#stateincentives"}State Incentives
    %li.tab
      %a{href: "#financial"}Incentive List
    %li.tab
      %a{href: "#laws"}Rules, Regulations, & Policies
  #stateincentives.grantsinfo
  :javascript
    $(document).ready(function(){
      var state=$('.state').text();
      $("#moregrants").load("http://www.afdc.energy.gov/laws/state_summary/"+state);
      $.ajax({
      url: 'http://www.afdc.energy.gov/laws/state_summary/'+state,
      type: 'GET',
      success: function(res)
      {
        var headline = $(res.responseText).find('.summary_table ul').first().html();
        var div = document.getElementById('stateincentives');
        div.innerHTML = headline;
        var heading = "<br><span class='categorytype'>State Incentives</span><hr>";
        $("#stateincentives").prepend(heading);
        $("#stateincentives a").each(function(){
          var _href = $(this).attr("href");
          $(this).attr("href", "http://www.afdc.energy.gov"+_href);
          $(this).attr("target", "_blank");
        });
      }
      });
    });
  #financial.grantsinfo
  :javascript
    $(document).ready(function(){
      var state=$('.state').text();
      $("#financial").load("http://www.dsireusa.org/incentives/index.cfm?re=0&ee=0&spv=0&st=0&srp=1&state="+state);
      $.ajax({
      url: 'http://www.dsireusa.org/incentives/index.cfm?re=0&ee=0&spv=0&st=0&srp=1&state='+state,
      type: 'GET',
      success: function(res)
      {
        var headline = $(res.responseText).find('#incentivelist').html();
        var lines = headline.split("\n");
        var financial = "";
        var frequency = 0;
        for (var i = 0, len = lines.length; i < len; i++) {
            if (lines[i].indexOf("categorytype") > -1)
              frequency+=1;
              if (frequency == 2)
                break;
            else
              financial += lines[i];
        }
        var div = document.getElementById('financial');
        div.innerHTML = financial;
        $("#financial ul li a").each(function(){
          var _href = $(this).attr("href");
          $(this).attr("href", "http://www.dsireusa.org/incentives/"+_href);
          $(this).attr("target", "_blank");
        });
      }
      });
    });
  #laws.grantsinfo
  :javascript
    $(document).ready(function(){
      var state=$('.state').text();
      $("#moregrants").load("http://www.afdc.energy.gov/laws/state_summary/"+state);
      $.ajax({
      url: 'http://www.afdc.energy.gov/laws/state_summary/'+state,
      type: 'GET',
      success: function(res)
      {
        var headline = $(res.responseText).find('.summary_table ul').last().html();
        var div = document.getElementById('laws');
        div.innerHTML = headline;
        var heading = "<br><span class='categorytype'>Rules, Regulations, and Policies</span><hr>";
        $("#laws").prepend(heading);
        $("#laws a").each(function(){
          var _href = $(this).attr("href");
          $(this).attr("href", "http://www.afdc.energy.gov"+_href);
          $(this).attr("target", "_blank");
        });
      }
      });
    });
:javascript
  $('#tab-container').easytabs();
